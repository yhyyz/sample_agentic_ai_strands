# nginx.conf
# nginx 用户和组
user    root root;
# work进程数，
worker_processes 4;
# nginx pid文件
pid       logs/nginx_CONTAINER_IP.pid;
# 单个worker最大打开的文件描述符个数
worker_rlimit_nofile 65535;
env SEND_S3_ONLY;
env KAFKA_BROKER_HOST;
env KAFKA_BROKER_PORT;
events
{
	#使用epoll模型
	use epoll;
	# 单个worker进程允许的最多连接数
	worker_connections 65535;
}
http
{
  lua_package_path "/opt/app/collect-app/lua-resty-kafka-master/lib/?.lua;;";
  resolver 8.8.8.8;
	include mime.types;
	default_type application/octet-stream;
	gzip on;
	gzip_min_length 1k;
	gzip_buffers 4 16k;
	gzip_http_version 1.0;
	gzip_comp_level 2;
	gzip_types text/plain application/x-javascript text/css application/xml;
	gzip_vary on;
	underscores_in_headers on;
	log_format main
		'$remote_addr - $remote_user [$time_local] '
		'$request_length '
		 '"$request" $status $bytes_sent $body_bytes_sent '
		'"$http_referer" "$http_user_agent" '
		'"$gzip_ratio" "$request_time" '
		'"$upstream_addr" "$upstream_status" "$upstream_response_time"';
	# 定义我们数据采集的 access 日志格式
	# 容器中禁用access_log
	access_log off;
	open_log_file_cache max=1000 inactive=60s;
	keepalive_timeout 0;
	client_max_body_size 20m;
	include /opt/app/collect-app/conf/vhost/*.conf;
	error_log logs/nginx_error_CONTAINER_IP.log error;
}
