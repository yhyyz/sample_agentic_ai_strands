# MCP on Amazon Bedrock - Next.js UI

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨Next.jsæ¡†æ¶æ„å»ºçš„Reactå‰ç«¯åº”ç”¨ï¼Œç”¨äºä¸Amazon Bedrockä¸Šçš„MCPæœåŠ¡è¿›è¡Œäº¤äº’ã€‚è¯¥åº”ç”¨æä¾›äº†ä¸€ä¸ªç°ä»£åŒ–ã€å“åº”å¼çš„ç”¨æˆ·ç•Œé¢ï¼Œæ”¯æŒä¸å„ç§å¤§è¯­è¨€æ¨¡å‹è¿›è¡Œå¯¹è¯ï¼Œå¹¶å¯ä»¥é…ç½®å’Œç®¡ç†MCPæœåŠ¡å™¨ã€‚

## åŠŸèƒ½ç‰¹ç‚¹
- ğŸš€ åŸºäºNext.js 14å’ŒReact 18æ„å»ºçš„ç°ä»£åŒ–å‰ç«¯ï¼Œæ”¯æŒDark/Lightæ¨¡å¼
- ğŸ¨ ä½¿ç”¨Tailwind CSSå’ŒShadcn UIç»„ä»¶åº“å®ç°ç¾è§‚çš„ç”¨æˆ·ç•Œé¢
- ğŸ”„ å®æ—¶æµå¼å“åº”ï¼Œæä¾›æµç•…çš„å¯¹è¯ä½“éªŒ
- ğŸ§  æ”¯æŒ"æ€è€ƒ"æ¨¡å¼ï¼Œå±•ç¤ºæ¨¡å‹çš„æ¨ç†è¿‡ç¨‹
- ğŸ› ï¸ MCPæœåŠ¡å™¨ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒæ·»åŠ å’Œé…ç½®æœåŠ¡å™¨
- ğŸ‘¤ ç”¨æˆ·ä¼šè¯ç®¡ç†ï¼Œä¿æŒå¯¹è¯ä¸Šä¸‹æ–‡
- ğŸ“Š å¯è§†åŒ–å·¥å…·ä½¿ç”¨ç»“æœï¼ŒåŒ…æ‹¬å›¾åƒæ˜¾ç¤º
- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œé€‚é…å„ç§è®¾å¤‡å°ºå¯¸

![alt text](image.png)
![alt text](image-1.png)
## æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: Next.js 15 (App Router)
- **UIåº“**: React 18, Tailwind CSS, Shadcn UI
- **çŠ¶æ€ç®¡ç†**: React Context API + Zustand
- **APIé€šä¿¡**: Fetch API, Server Actions
- **å®æ—¶é€šä¿¡**: Server-Sent Events (SSE)

## å¿«é€Ÿå¼€å§‹

### ä½¿ç”¨Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

#### å‰ææ¡ä»¶
- å®‰è£…Dockerå’ŒDocker Composeï¼šhttps://docs.docker.com/get-docker/
- Linuxä¸‹å®‰è£…Dockerå‘½ä»¤ï¼š
```bash
# å®‰è£…Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å®‰è£…Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.24.6/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
ln -s /usr/bin/docker-compose  /usr/local/bin/docker-compose
```
1. å…‹éš†ä»“åº“ä¹‹å
```bash
cd sample_agentic_ai_strands/react_ui
```

2. åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
```bash
cp .env.example .env.local
```


#### Option 1: HTTPæ¨¡å¼
1. ç¼–è¾‘`.env.local`æ–‡ä»¶ï¼Œæ·»åŠ å¿…è¦çš„ç¯å¢ƒå˜é‡ï¼ˆDockerä¼šè‡ªåŠ¨ä»è¯¥æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡ï¼‰
```
# API Key for authentication
NEXT_PUBLIC_API_KEY=123456

# Base URL for MCP service - Server side (internal)
# ç”±äºä½¿ç”¨hostç½‘ç»œæ¨¡å¼ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨localhostè®¿é—®å®¿ä¸»æœºæœåŠ¡
SERVER_MCP_BASE_URL=http://localhost:7002

# Base URL for MCP service - Client side (å¿…é¡»ä½¿ç”¨Next.js APIè·¯ç”±é¿å…CORSé—®é¢˜)
NEXT_PUBLIC_MCP_BASE_URL=/api
```

> **æ³¨æ„**ï¼šæˆ‘ä»¬ä½¿ç”¨Dockerçš„hostç½‘ç»œæ¨¡å¼ï¼ˆnetwork_mode: "host"ï¼‰ï¼Œä½¿å®¹å™¨ç›´æ¥å…±äº«å®¿ä¸»æœºçš„ç½‘ç»œæ ˆã€‚
> è¿™æ ·å®¹å™¨å¯ä»¥ç›´æ¥ä½¿ç”¨localhostè®¿é—®å®¿ä¸»æœºä¸Šè¿è¡Œçš„æœåŠ¡ï¼Œç®€åŒ–äº†é…ç½®ã€‚
> ä½¿ç”¨hostç½‘ç»œæ¨¡å¼æ—¶ï¼Œå®¹å™¨çš„ç«¯å£ä¼šç›´æ¥æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šï¼Œæ— éœ€é¢å¤–çš„ç«¯å£æ˜ å°„ã€‚

2. ä½¿ç”¨Docker Composeæ„å»ºå¹¶å¯åŠ¨æœåŠ¡
```bash
docker-compose up -d
```

3. å¦‚æœæ˜¯æœ¬åœ°éƒ¨ç½²ï¼Œåˆ™åœ¨æµè§ˆå™¨ä¸­è®¿é—® [http://localhost:3000/chat](http://localhost:3000/chat) å¦‚æœåœ¨ec2éƒ¨ç½²ï¼Œåˆ™è®¿é—®ec2 ip


#### å…¶ä»–Dockerå¸¸ç”¨å‘½ä»¤
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs -f mcp-bedrock-ui

# é‡å¯å®¹å™¨
docker-compose restart

# åœæ­¢å®¹å™¨
docker-compose down

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨ï¼ˆä»£ç æ›´æ–°åï¼‰
docker-compose up -d --build
```




### ä½¿ç”¨Node.jsç›´æ¥éƒ¨ç½²ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

#### å‰ææ¡ä»¶

- Node.js 22.x æˆ–æ›´é«˜ç‰ˆæœ¬, å®‰è£…å‚è€ƒï¼šhttps://nodejs.org/en/download   
- Linuxä¸‹å®‰è£…å‘½ä»¤
```bash
# Download and install nvm:
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.2/install.sh | bash

# in lieu of restarting the shell
\. "$HOME/.nvm/nvm.sh"

# Download and install Node.js:
nvm install 22

# Verify the Node.js version:
node -v # Should print "v22.14.0".
nvm current # Should print "v22.14.0".

# Verify npm version:
npm -v # Should print "10.9.2".
```

### å®‰è£…æ­¥éª¤

1. å…‹éš†ä»“åº“ä¹‹å
```bash
cd demo_mcp_on_amazon_bedrock/react_ui
```

2. å®‰è£…ä¾èµ–
```bash
npm install
```
- å®‰è£…pm2å·¥å…·
```bash
npm -g install pm2
```

3. åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
```bash
cp .env.example .env.local
```

4. ç¼–è¾‘`.env.local`æ–‡ä»¶ï¼Œæ·»åŠ å¿…è¦çš„ç¯å¢ƒå˜é‡, `API_KEY`è·Ÿåç«¯MCPåå°æœåŠ¡ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­.envå®šä¹‰çš„ä¸€è‡´å°±å¯ä»¥
```
NEXT_PUBLIC_API_KEY=123456
SERVER_MCP_BASE_URL=http://localhost:7002
NEXT_PUBLIC_MCP_BASE_URL=/api
```

5. å¯åŠ¨å¼€å‘æ¨¡å¼
```bash
npm run dev
```

6. åœ¨æµè§ˆå™¨ä¸­è®¿é—® [http://localhost:3000/chat](http://localhost:3000/chat)

## é¡¹ç›®ç»“æ„

```
/
â”œâ”€â”€ app/                  # Next.js App Router
â”‚   â”œâ”€â”€ api/              # APIè·¯ç”±
â”‚   â”œâ”€â”€ chat/             # èŠå¤©é¡µé¢
â”‚   â””â”€â”€ page.tsx          # é¦–é¡µ
â”œâ”€â”€ components/           # Reactç»„ä»¶
â”‚   â”œâ”€â”€ chat/             # èŠå¤©ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ mcp/              # MCPæœåŠ¡å™¨ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ ui/               # UIç»„ä»¶åº“
â”‚   â””â”€â”€ providers/        # ä¸Šä¸‹æ–‡æä¾›è€…
â”œâ”€â”€ lib/                  # å·¥å…·å‡½æ•°å’ŒæœåŠ¡
â”‚   â”œâ”€â”€ api/              # APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ hooks/            # è‡ªå®šä¹‰Hooks
â”‚   â”œâ”€â”€ store/            # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
â”œâ”€â”€ pages/                # Pages Router (APIè·¯ç”±)
â”‚   â””â”€â”€ api/              # APIç«¯ç‚¹
â”œâ”€â”€ public/               # é™æ€èµ„æº
â”œâ”€â”€ styles/               # å…¨å±€æ ·å¼
â”œâ”€â”€ .dockerignore         # Dockerå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ docker-compose.yml    # Docker Composeé…ç½®
â”œâ”€â”€ Dockerfile            # Dockeræ„å»ºæ–‡ä»¶
â””â”€â”€ pm2run.config.js      # PM2é…ç½®æ–‡ä»¶
```

## Dockeréƒ¨ç½²æ¶æ„

ä½¿ç”¨Dockeréƒ¨ç½²æ—¶ï¼Œåº”ç”¨ç¨‹åºè¿è¡Œåœ¨å®¹å™¨åŒ–ç¯å¢ƒä¸­ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- ğŸ”„ ä¸€è‡´çš„è¿è¡Œç¯å¢ƒï¼Œé¿å…"åœ¨æˆ‘çš„æœºå™¨ä¸Šèƒ½è¿è¡Œ"çš„é—®é¢˜
- ğŸš€ ç®€åŒ–çš„éƒ¨ç½²æµç¨‹ï¼Œåªéœ€ä¸€ä¸ªå‘½ä»¤å³å¯å¯åŠ¨
- ğŸ›¡ï¸ éš”ç¦»çš„åº”ç”¨ç¯å¢ƒï¼Œæé«˜å®‰å…¨æ€§
- ğŸ“¦ ä¾¿äºåˆ†å‘å’Œç‰ˆæœ¬æ§åˆ¶
- ğŸ”Œ ä¸å…¶ä»–Dockerå®¹å™¨åŒ–æœåŠ¡ï¼ˆå¦‚æ•°æ®åº“ã€ç¼“å­˜ç­‰ï¼‰è½»æ¾é›†æˆ

### ç½‘ç»œæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚  Docker Host                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚                         â”‚                                    â”‚
â”‚  â”‚  mcp-bedrock-ui         â”‚                                    â”‚
â”‚  â”‚  (Next.js Application)  â”‚â—„â”€â”€â”€â”                               â”‚
â”‚  â”‚  Port: 3000             â”‚    â”‚                               â”‚
â”‚  â”‚                         â”‚    â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                               â”‚
â”‚              â”‚                  â”‚                               â”‚
â”‚              â”‚                  â”‚                               â”‚
â”‚              â–¼                  â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                       â”‚      â””â”€â”€â”€â”€â”€â”€â”¤                     â”‚  â”‚
â”‚  â”‚  Next.js API Routes   â”‚             â”‚  Browser            â”‚  â”‚
â”‚  â”‚  (/api/*)             â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚  â”‚
â”‚  â”‚                       â”‚             â”‚                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                                                  â”‚
â”‚              â”‚                                                  â”‚
â”‚              â–¼                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚  â”‚                       â”‚                                      â”‚
â”‚  â”‚  MCP Backend Service  â”‚                                      â”‚
â”‚  â”‚  Port: 7002           â”‚                                      â”‚
â”‚  â”‚                       â”‚                                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```